<html>
<head>
  <title>Staff Dashboard - Hao's Signature</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
    
<style>
    .background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 130%;
      margin: 0;
      padding: 0;
      background-image: url('img/restaurant1.jpg');
      background-size: cover;
      background-position: center center;
      background-attachment: scroll;
      z-index: 0;
    }

    .dim-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 130%;
      background-color: rgba(0, 0, 0, 0.7); 
      z-index: 1;
    }

    .content {
      position: relative;
      z-index: 2; 
      color: white;
      padding: 20px;
    }

    .dashboard-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .dashboard-card {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 20px;
        backdrop-filter: blur(10px);
        transition: transform 0.3s ease;
    }

    .dashboard-card:hover {
        transform: translateY(-5px);
    }

    .dashboard-card h3 {
        color: #2196F3;
        margin-bottom: 15px;
    }

    .dashboard-card p {
        margin-bottom: 15px;
    }

    .action-btn {
        background-color: #2196F3;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .action-btn:hover {
        background-color: #1976D2;
    }

    .stats-container {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
    }

    .stat-box {
        text-align: center;
        padding: 15px;
    }

    .stat-box h4 {
        color: #2196F3;
        margin-bottom: 10px;
    }

    .logout-btn {
        background-color: #ff4444;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        float: right;
        margin: 10px;
    }

    .logout-btn:hover {
        background-color: #cc0000;
    }

    .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }

    .action-btn {
        padding: 10px 20px;
        background-color: #2196F3;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .action-btn:hover {
        background-color: #1976D2;
    }

    .management-section {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .section-header h2 {
        color: white;
        margin: 0;
    }

    .analytics-container {
        display: none;
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .analytics-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 20px;
    }

    .analytics-card h3 {
        color: #2196F3;
        margin-top: 0;
        margin-bottom: 15px;
    }

    .analytics-stats {
        display: grid;
        gap: 15px;
    }

    .stat-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 5px;
    }

    .stat-label {
        color: #ffffff;
        font-size: 0.9em;
    }

    .stat-value {
        color: #2196F3;
        font-weight: bold;
        font-size: 1.1em;
    }

    #popularItems {
        color: white;
    }

    .popular-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px dashed #eee;
    }

    .popular-item:last-child {
        border-bottom: none;
    }

    .management-button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 12px 24px;
        background: linear-gradient(45deg, #2196F3, #1976D2);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin: 10px;
        cursor: pointer;
    }

    .management-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        background: linear-gradient(45deg, #1976D2, #1565C0);
    }

    .management-button i {
        margin-right: 8px;
        font-size: 20px;
    }

    .management-button:active {
        transform: translateY(1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .status-badge {
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.8em;
    }

    .status-pending {
        background: #ffeeba;
        color: #856404;
    }

    .status-preparing {
        background: #b8daff;
        color: #004085;
    }

    .status-ready {
        background: #c3e6cb;
        color: #155724;
    }

    .status-completed {
        background: #d4edda;
        color: #155724;
    }

    .filter-container {
        margin-bottom: 20px;
    }

    .filter-select {
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #ddd;
    }

    .action-btn, .delete-btn {
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin: 0 2px;
    }

    .action-btn {
        background: #007bff;
        color: white;
    }

    .delete-btn {
        background: #dc3545;
        color: white;
    }

    .receipt-container {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
    }

    .receipt {
        background: rgba(255, 255, 255, 0.95);
        color: #333;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        font-family: 'Courier New', monospace;
    }

    .receipt-header {
        text-align: center;
        border-bottom: 2px dashed #ccc;
        padding-bottom: 20px;
        margin-bottom: 20px;
    }

    .receipt-header h2 {
        color: #333;
        margin: 0;
        font-size: 24px;
    }

    .receipt-content {
        padding: 20px 0;
    }

    .receipt-section {
        margin-bottom: 25px;
        border-bottom: 1px dashed #ccc;
        padding-bottom: 15px;
    }

    .receipt-section:last-child {
        border-bottom: none;
    }

    .receipt-section h4 {
        color: #333;
        margin-bottom: 15px;
        font-size: 18px;
    }

    .receipt-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 14px;
    }

    .receipt-footer {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 2px dashed #ccc;
    }

    .print-btn {
        background: #2196F3;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 15px;
        font-family: Arial, sans-serif;
    }

    .print-btn:hover {
        background: #1976D2;
    }

    @media print {
        body * {
            visibility: hidden;
        }
        .receipt, .receipt * {
            visibility: visible;
        }
        .receipt {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            box-shadow: none;
        }
        .print-btn {
            display: none;
        }
    }

    .popular-items {
        margin-top: 10px;
    }

    .popular-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px dashed #eee;
    }

    .popular-item:last-child {
        border-bottom: none;
    }
</style>
    
<body>
    <div class="background"></div>
    <div class="dim-overlay"></div>
    <div class="content">
        <header>
            <button class="logout-btn" onclick="window.location.href='login.html'">Logout</button>
            <h1>Staff Dashboard - Hao's Signature</h1>
            <p>Welcome back, Staff !</p>
        </header>

        <nav>
            <a href="StaffLanding.html">Overview</a>
            <a href="StaffOrderMgnt.html">Manage Orders</a>
            <a href="StaffMgnt.html">Staff Management</a>
            <a href="MemberMgnt.html">Member Management</a>
            <a href="SalesRpt.html">Reports</a>
            <a href="MenuMgnt.html">Menu Management</a>
        </nav><br><br>
         <div class="dashboard-card">
                <h3>Reports & Analytics</h3>
                <p>View sales and performance reports</p>
                <div class="action-buttons">
                    <button class="action-btn" onclick="showReports()">View Reports</button>
                    <button class="action-btn" onclick="generateDailyReport()">Daily Report</button>
                </div>
            </div>
         </div>
        <footer>
            <p><b>Â© 2025</b> | Hao's Signature Reserved All the Right.</p>
        </footer>
        <script>
    // Function to display orders
    function displayOrders() {
        const allFeedback = JSON.parse(localStorage.getItem('feedback')) || [];
        const recentOrdersDiv = document.getElementById('recent-orders');
        
        if (allFeedback.length === 0) {
            recentOrdersDiv.innerHTML = '<p>No orders yet</p>';
            return;
        }

        let ordersHTML = '<div style="color: white;">';
        
        // Display orders from newest to oldest
        allFeedback.reverse().forEach((feedback, index) => {
            const orderDate = new Date(feedback.date).toLocaleString();
            let orderTotal = 0;
            
            ordersHTML += `
                <div style="background: rgba(255,255,255,0.1); padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <h4 style="color: #2196F3; margin-bottom: 10px;">Order #${allFeedback.length - index}</h4>
                        <button onclick="deleteOrder(${index})" style="background-color: #ff4444; color: white; border: none; border-radius: 5px; padding: 5px 10px; cursor: pointer; transition: background-color 0.3s;">
                            Delete
                        </button>
                    </div>
                    <p>Customer: ${feedback.name}</p>
                    <p>Email: ${feedback.email}</p>
                    <p>Date: ${orderDate}</p>
                    <p>Items:</p>
                    <ul style="list-style-type: none; padding-left: 10px;">
            `;
            
            feedback.order.forEach(item => {
                const subtotal = item.price * item.quantity;
                orderTotal += subtotal;
                ordersHTML += `
                    <li>${item.name} x ${item.quantity} - $${subtotal.toFixed(2)}</li>
                `;
            });
            
            ordersHTML += `
                    </ul>
                    <p style="font-weight: bold; margin-top: 10px;">Total: $${orderTotal.toFixed(2)}</p>
                    <p>Rating: ${'â'.repeat(feedback.rating)}${'â'.repeat(5-feedback.rating)}</p>
                    <p>Comments: ${feedback.comments}</p>
                </div>
            `;
        });
        
        ordersHTML += '</div>';
        recentOrdersDiv.innerHTML = ordersHTML;
        
        // Update stats
        updateDashboardStats(allFeedback);
    }

    // Function to delete an order
    function deleteOrder(index) {
        if (confirm('Are you sure you want to delete this order?')) {
            let allFeedback = JSON.parse(localStorage.getItem('feedback')) || [];
            // Since we reversed the array for display, we need to adjust the index
            const actualIndex = allFeedback.length - 1 - index;
            allFeedback.splice(actualIndex, 1);
            localStorage.setItem('feedback', JSON.stringify(allFeedback));
            displayOrders(); // Refresh the display
            alert('Order deleted successfully');
        }
    }

    // Function to update dashboard statistics
    function updateDashboardStats(allFeedback) {
        const today = new Date().toDateString();
        
        // Count today's orders
        const todayOrders = allFeedback.filter(f => 
            new Date(f.date).toDateString() === today
        ).length;
        
        // Calculate total revenue
        const totalRevenue = allFeedback.reduce((total, feedback) => {
            const orderTotal = feedback.order.reduce((sum, item) => 
                sum + (item.price * item.quantity), 0
            );
            return total + orderTotal;
        }, 0);
        
        // Update stats in the UI
        document.querySelector('.stat-box:nth-child(1) p').textContent = todayOrders;
        document.querySelector('.stat-box:nth-child(2) p').textContent = `$${totalRevenue.toFixed(2)}`;
    }

    // Function to view all orders (can be expanded later)
    function viewAllOrders() {
        // You can implement a separate page or modal for viewing all orders
        alert('View all orders functionality coming soon!');
    }

    // Staff Management Functions
    function loadStaffList() {
        const staffList = JSON.parse(localStorage.getItem('staffList')) || [];
        const staffListDiv = document.getElementById('staff-list');
        
        if (staffList.length === 0) {
            staffListDiv.innerHTML = '<p style="color: white;">No staff members added yet</p>';
            return;
        }

        let staffHTML = '<div style="color: white;">';
        staffList.forEach((staff, index) => {
            staffHTML += `
                <div style="background: rgba(255,255,255,0.1); padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h4 style="color: #2196F3; margin-bottom: 10px;">${staff.name}</h4>
                            <p>Staff ID: ${staff.staffId}</p>
                            <p>Position: ${staff.position}</p>
                        </div>
                        <div>
                            <button onclick="editStaff(${index})" style="background-color: #2196F3; color: white; border: none; border-radius: 5px; padding: 5px 10px; margin-right: 5px; cursor: pointer;">
                                Edit
                            </button>
                            <button onclick="deleteStaff(${index})" style="background-color: #ff4444; color: white; border: none; border-radius: 5px; padding: 5px 10px; cursor: pointer;">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            `;
        });
        staffHTML += '</div>';
        staffListDiv.innerHTML = staffHTML;
    }

    function showAddStaffForm() {
        document.getElementById('modalTitle').textContent = 'Add New Staff';
        document.getElementById('staffForm').reset();
        document.getElementById('editingId').value = '';
        document.getElementById('staffModal').style.display = 'block';
    }

    function closeStaffModal() {
        document.getElementById('staffModal').style.display = 'none';
    }

    function handleStaffSubmit(event) {
        event.preventDefault();
        
        const staffData = {
            staffId: document.getElementById('staffId').value,
            name: document.getElementById('staffName').value,
            position: document.getElementById('staffPosition').value,
            password: document.getElementById('staffPassword').value
        };

        let staffList = JSON.parse(localStorage.getItem('staffList')) || [];
        const editingId = document.getElementById('editingId').value;

        if (editingId === '') {
            // Adding new staff
            staffList.push(staffData);
        } else {
            // Editing existing staff
            staffList[editingId] = staffData;
        }

        localStorage.setItem('staffList', JSON.stringify(staffList));
        closeStaffModal();
        loadStaffList();
        alert(editingId === '' ? 'Staff added successfully!' : 'Staff updated successfully!');
    }

    function editStaff(index) {
        const staffList = JSON.parse(localStorage.getItem('staffList')) || [];
        const staff = staffList[index];
        
        document.getElementById('modalTitle').textContent = 'Edit Staff';
        document.getElementById('staffId').value = staff.staffId;
        document.getElementById('staffName').value = staff.name;
        document.getElementById('staffPosition').value = staff.position;
        document.getElementById('staffPassword').value = staff.password;
        document.getElementById('editingId').value = index;
        
        document.getElementById('staffModal').style.display = 'block';
    }

    function deleteStaff(index) {
        if (confirm('Are you sure you want to delete this staff member?')) {
            let staffList = JSON.parse(localStorage.getItem('staffList')) || [];
            staffList.splice(index, 1);
            localStorage.setItem('staffList', JSON.stringify(staffList));
            loadStaffList();
            alert('Staff member deleted successfully');
        }
    }

    // Member Management Functions
    function loadMemberList() {
        const members = JSON.parse(localStorage.getItem('users')) || [];
        const memberListDiv = document.getElementById('member-list');
        
        if (members.length === 0) {
            memberListDiv.innerHTML = '<p style="color: white;">No registered members yet</p>';
            return;
        }

        let memberHTML = '<div style="color: white;">';
        members.forEach((member, index) => {
            memberHTML += `
                <div style="background: rgba(255,255,255,0.1); padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h4 style="color: #2196F3; margin-bottom: 10px;">${member.username}</h4>
                            <p>Email: ${member.email}</p>
                            <p>Phone: ${member.phone}</p>
                            <p>Registration Date: ${new Date(member.registrationDate).toLocaleDateString()}</p>
                        </div>
                        <div>
                            <button onclick="editMember(${index})" 
                                    style="background-color: #2196F3; color: white; border: none; border-radius: 5px; padding: 5px 10px; margin-right: 5px; cursor: pointer;">
                                Edit
                            </button>
                            <button onclick="deleteMember(${index})" 
                                    style="background-color: #ff4444; color: white; border: none; border-radius: 5px; padding: 5px 10px; cursor: pointer;">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            `;
        });
        memberHTML += '</div>';
        memberListDiv.innerHTML = memberHTML;
    }

    function editMember(index) {
        const members = JSON.parse(localStorage.getItem('users')) || [];
        const member = members[index];
        
        // Create and show modal for editing
        const modalHTML = `
            <div id="memberModal" style="display: block; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                <div style="position: relative; background: white; margin: 15% auto; padding: 20px; width: 50%; border-radius: 5px; color: black;">
                    <span onclick="closeMemberModal()" style="position: absolute; right: 10px; top: 10px; cursor: pointer; font-size: 20px;">&times;</span>
                    <h3>Edit Member</h3>
                    <form id="editMemberForm" onsubmit="handleMemberEdit(event, ${index})">
                        <div style="margin-bottom: 15px;">
                            <label>Full Name:</label>
                            <input type="text" id="editUsername" value="${member.username}" required style="width: 100%; padding: 8px; margin-top: 5px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label>Email:</label>
                            <input type="email" id="editEmail" value="${member.email}" required style="width: 100%; padding: 8px; margin-top: 5px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label>Phone:</label>
                            <input type="tel" id="editPhone" value="${member.phone}" required style="width: 100%; padding: 8px; margin-top: 5px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label>Password:</label>
                            <input type="password" id="editPassword" value="${member.password}" required style="width: 100%; padding: 8px; margin-top: 5px;">
                        </div>
                        <button type="submit" class="action-btn" style="width: 100%; background-color: #2196F3;">Save Changes</button>
                    </form>
                </div>
            </div>
        `;
        
        // Add modal to body
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    }

    function closeMemberModal() {
        const modal = document.getElementById('memberModal');
        if (modal) {
            modal.remove();
        }
    }

    function handleMemberEdit(event, index) {
        event.preventDefault();
        
        const members = JSON.parse(localStorage.getItem('users')) || [];
        
        // Get updated values
        const updatedMember = {
            username: document.getElementById('editUsername').value,
            email: document.getElementById('editEmail').value,
            phone: document.getElementById('editPhone').value,
            password: document.getElementById('editPassword').value,
            registrationDate: members[index].registrationDate // Keep original registration date
        };
        
        // Update member in array
        members[index] = updatedMember;
        
        // Save to localStorage
        localStorage.setItem('users', JSON.stringify(members));
        
        // Close modal and refresh list
        closeMemberModal();
        loadMemberList();
        alert('Member updated successfully');
    }

    function deleteMember(index) {
        if (confirm('Are you sure you want to delete this member? This action cannot be undone.')) {
            let members = JSON.parse(localStorage.getItem('users')) || [];
            members.splice(index, 1);
            localStorage.setItem('users', JSON.stringify(members));
            loadMemberList();
            alert('Member deleted successfully');
        }
    }

    function deleteMemberHistory() {
        if (confirm('Are you sure you want to clear all member history? This action cannot be undone.')) {
            localStorage.removeItem('users');
            loadMemberList();
            alert('Member history cleared successfully');
        }
    }

    // Menu Management Functions
    function handleMenuItemSubmit(event) {
        event.preventDefault();
        
        const menuItem = {
            category: document.getElementById('itemCategory').value,
            name: document.getElementById('itemName').value,
            description: document.getElementById('itemDescription').value,
            price: parseFloat(document.getElementById('itemPrice').value)
        };

        // Get the appropriate storage key and HTML template based on category
        let storageKey, htmlTemplate;
        switch(menuItem.category) {
            case 'maindish':
                storageKey = 'mainDishItems';
                htmlTemplate = `
                    <tr>
                        <td>${menuItem.name}</td>
                        <td>${menuItem.description}</td>
                        <td>
                            <span class="price-column">$${menuItem.price.toFixed(2)}</span>
                            <button class="AddCartBtn" data-name="${menuItem.name}" data-price="${menuItem.price.toFixed(2)}">Add to cart</button>
                        </td>
                    </tr>`;
                break;
            case 'meat':
                storageKey = 'meatItems';
                htmlTemplate = `
                    <tr>
                        <td>${menuItem.name}</td>
                        <td>${menuItem.description}</td>
                        <td>
                            <span class="price-column">$${menuItem.price.toFixed(2)}</span>
                            <button class="AddCartBtn" data-name="${menuItem.name}" data-price="${menuItem.price.toFixed(2)}">Add to cart</button>
                        </td>
                    </tr>`;
                break;
            case 'desserts':
                storageKey = 'dessertItems';
                htmlTemplate = `
                    <tr>
                        <td>${menuItem.name}</td>
                        <td>
                            <span class="price-column">$${menuItem.price.toFixed(2)}</span>
                            <button class="AddCartBtn" data-name="${menuItem.name}" data-price="${menuItem.price.toFixed(2)}">Add to cart</button>
                        </td>
                    </tr>`;
                break;
            case 'espresso':
                storageKey = 'espressoItems';
                if (menuItem.temperatures && menuItem.temperatures.length > 0) {
                    htmlTemplate = `
                        <tr>
                            <td>${menuItem.name}</td>
                            ${menuItem.temperatures.includes('Hot') ? `
                            <td>
                                <span class="price">$${menuItem.price.toFixed(2)}</span>
                                <button class="AddCartBtn" data-name="${menuItem.name} (Hot)" data-price="${menuItem.price.toFixed(2)}">Add to cart</button>
                            </td>` : '<td>-</td>'}
                            ${menuItem.temperatures.includes('Cold') ? `
                            <td>
                                <span class="price">$${(menuItem.price + 2).toFixed(2)}</span>
                                <button class="AddCartBtn" data-name="${menuItem.name} (Cold)" data-price="${(menuItem.price + 2).toFixed(2)}">Add to cart</button>
                            </td>` : '<td>-</td>'}
                        </tr>`;
                }
                break;
            case 'housecoolers':
                storageKey = 'coolerItems';
                htmlTemplate = `
                    <tr>
                        <td>${menuItem.name}</td>
                        <td>$${menuItem.price.toFixed(2)}</td>
                        <td width="20px">
                            <button class="AddCartBtn" data-name="${menuItem.name}" data-price="${menuItem.price.toFixed(2)}">Add to cart</button>
                        </td>
                    </tr>`;
                break;
        }

        // Get existing items for this category
        let categoryItems = JSON.parse(localStorage.getItem(storageKey)) || [];
        const editingId = document.getElementById('editingItemId').value;

        if (editingId === '') {
            categoryItems.push({
                ...menuItem,
                htmlTemplate: htmlTemplate
            });
        } else {
            categoryItems[editingId] = {
                ...menuItem,
                htmlTemplate: htmlTemplate
            };
        }

        // Save to localStorage
        localStorage.setItem(storageKey, JSON.stringify(categoryItems));

        // Generate and save the complete menu HTML
        let completeHTML = '';
        categoryItems.forEach(item => {
            completeHTML += item.htmlTemplate;
        });
        localStorage.setItem(`${storageKey}_html`, completeHTML);

        closeMenuModal();
        loadMenuList();
        alert(editingId === '' ? 'Menu item added successfully!' : 'Menu item updated successfully!');
    }

    function loadMenuList() {
        const selectedCategory = document.getElementById('menuCategory').value;
        let storageKey;
        
        // Determine which storage key to use based on category
        switch(selectedCategory) {
            case 'maindish':
                storageKey = 'mainDishItems';
                break;
            case 'meat':
                storageKey = 'meatItems';
                break;
            case 'desserts':
                storageKey = 'dessertItems';
                break;
            case 'espresso':
                storageKey = 'espressoItems';
                break;
            case 'housecoolers':
                storageKey = 'coolerItems';
                break;
        }

        const menuItems = JSON.parse(localStorage.getItem(storageKey)) || [];
        const menuListDiv = document.getElementById('menu-list');
        
        if (menuItems.length === 0) {
            menuListDiv.innerHTML = '<p style="color: white;">No menu items in this category</p>';
            return;
        }

        let menuHTML = '<div style="color: white;">';
        menuItems.forEach((item, index) => {
            menuHTML += `
                <div style="background: rgba(255,255,255,0.1); padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h4 style="color: #2196F3; margin-bottom: 10px;">${item.name}</h4>
                            <p>Category: ${item.category}</p>
                            <p>Price: $${item.price.toFixed(2)}</p>
                            ${item.description ? `<p>Description: ${item.description}</p>` : ''}
                            ${item.temperatures ? `<p>Available: ${item.temperatures.join(', ')}</p>` : ''}
                        </div>
                        <div>
                            <button onclick="editMenuItem(${index}, '${storageKey}')" 
                                    style="background-color: #2196F3; color: white; border: none; border-radius: 5px; padding: 5px 10px; margin-right: 5px; cursor: pointer;">
                                Edit
                            </button>
                            <button onclick="deleteMenuItem(${index}, '${storageKey}')" 
                                    style="background-color: #ff4444; color: white; border: none; border-radius: 5px; padding: 5px 10px; cursor: pointer;">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            `;
        });
        menuHTML += '</div>';
        menuListDiv.innerHTML = menuHTML;
    }

    function showAddMenuItemForm() {
        document.getElementById('menuModalTitle').textContent = 'Add New Menu Item';
        document.getElementById('menuForm').reset();
        document.getElementById('editingItemId').value = '';
        document.getElementById('menuModal').style.display = 'block';
        updateTemperatureOptions();
    }

    function updateTemperatureOptions() {
        const category = document.getElementById('itemCategory').value;
        const temperatureDiv = document.getElementById('temperatureOptions');
        temperatureDiv.style.display = (category === 'espresso') ? 'block' : 'none';
    }

    function closeMenuModal() {
        document.getElementById('menuModal').style.display = 'none';
    }

    function editMenuItem(index, storageKey) {
        const menuItems = JSON.parse(localStorage.getItem(storageKey)) || [];
        const item = menuItems[index];
        
        document.getElementById('menuModalTitle').textContent = 'Edit Menu Item';
        document.getElementById('itemCategory').value = item.category;
        document.getElementById('itemName').value = item.name;
        document.getElementById('itemDescription').value = item.description || '';
        document.getElementById('itemPrice').value = item.price;
        document.getElementById('editingItemId').value = index;
        
        if (item.category === 'espresso' && item.temperatures) {
            document.getElementById('hotOption').checked = item.temperatures.includes('Hot');
            document.getElementById('coldOption').checked = item.temperatures.includes('Cold');
        }
        
        document.getElementById('menuModal').style.display = 'block';
        updateTemperatureOptions();
    }

    function deleteMenuItem(index, storageKey) {
        if (confirm('Are you sure you want to delete this menu item?')) {
            let menuItems = JSON.parse(localStorage.getItem(storageKey)) || [];
            menuItems.splice(index, 1);
            localStorage.setItem(storageKey, JSON.stringify(menuItems));
            loadMenuList();
            alert('Menu item deleted successfully');
        }
    }

    // Add event listener for category change
    document.getElementById('menuCategory').addEventListener('change', loadMenuList);

    // Add these new functions for the Active Orders section
    function displayActiveOrders() {
        const allOrders = JSON.parse(localStorage.getItem('feedback')) || [];
        const activeOrdersDiv = document.getElementById('active-orders');
        const filterValue = document.getElementById('orderFilter').value;
        
        if (allOrders.length === 0) {
            activeOrdersDiv.innerHTML = '<p style="color: white;">No active orders</p>';
            return;
        }

        let filteredOrders = allOrders;
        if (filterValue !== 'all') {
            filteredOrders = allOrders.filter(order => order.status === filterValue);
        }

        let ordersHTML = '<div style="color: white;">';
        filteredOrders.reverse().forEach((order, index) => {
            const orderDate = new Date(order.date).toLocaleString();
            const orderTotal = order.order.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            ordersHTML += `
                <div style="background: rgba(255,255,255,0.1); padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h4 style="color: #2196F3; margin-bottom: 10px;">Order #${allOrders.length - index}</h4>
                            <p>Customer: ${order.name}</p>
                            <p>Total: $${orderTotal.toFixed(2)}</p>
                            <p>Status: ${order.status || 'pending'}</p>
                            <p>Date: ${orderDate}</p>
                            <p>Items:</p>
                            <ul style="list-style-type: none; padding-left: 10px;">
                                ${order.order.map(item => `
                                    <li>${item.name} x ${item.quantity}</li>
                                `).join('')}
                            </ul>
                        </div>
                        <div>
                            <button onclick="updateOrderStatus(${index})" class="action-btn" style="
                                background-color: #2196F3;
                                color: white;
                                border: none;
                                padding: 8px 16px;
                                border-radius: 4px;
                                cursor: pointer;
                                margin-bottom: 5px;
                                width: 120px;
                            ">Update Status</button>
                            <button onclick="deleteOrder(${index})" class="action-btn" style="
                                background-color: #ff4444;
                                color: white;
                                border: none;
                                padding: 8px 16px;
                                border-radius: 4px;
                                cursor: pointer;
                                width: 120px;
                            ">Delete</button>
                        </div>
                    </div>
                </div>
            `;
        });
        ordersHTML += '</div>';
        activeOrdersDiv.innerHTML = ordersHTML;
    }

    function refreshOrders() {
        displayActiveOrders();
    }

    // Add event listener for order filter
    document.getElementById('orderFilter').addEventListener('change', displayActiveOrders);

    // Update the initialization to include active orders display
    document.addEventListener('DOMContentLoaded', function() {
        displayOrders();
        loadStaffList();
        loadMemberList();
        loadMenuList();
        displayRecentOrders();
        displayActiveOrders();
    });

    // Close modal when clicking outside
    window.onclick = function(event) {
        const modal = document.getElementById('staffModal');
        if (event.target == modal) {
            closeStaffModal();
        }
        const memberModal = document.getElementById('memberModal');
        if (event.target == memberModal) {
            closeMemberModal();
        }
        const menuModal = document.getElementById('menuModal');
        if (event.target == menuModal) {
            closeMenuModal();
        }
    }

    // Add this function to display recent orders in the box
    function displayRecentOrders() {
        const allOrders = JSON.parse(localStorage.getItem('feedback')) || [];
        const recentOrdersDiv = document.getElementById('recent-orders');
        
        if (allOrders.length === 0) {
            recentOrdersDiv.innerHTML = '<p style="color: white;">No orders yet</p>';
            return;
        }

        // Display only the 3 most recent orders
        let ordersHTML = '<div style="color: white;">';
        allOrders.slice(-3).reverse().forEach((order, index) => {
            const orderDate = new Date(order.date).toLocaleString();
            const orderTotal = order.order.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            ordersHTML += `
                <div style="background: rgba(255,255,255,0.1); padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h4 style="color: #2196F3; margin-bottom: 10px;">Order #${allOrders.length - index}</h4>
                            <p>Customer: ${order.name}</p>
                            <p>Total: $${orderTotal.toFixed(2)}</p>
                            <p>Date: ${orderDate}</p>
                        </div>
                        <div>
                            <span class="status-badge status-${order.status || 'pending'}" style="
                                padding: 5px 10px;
                                border-radius: 15px;
                                font-size: 14px;
                                background: ${order.status === 'completed' ? '#c3e6cb' : 
                                           order.status === 'ready' ? '#b8daff' : 
                                           order.status === 'preparing' ? '#ffeeba' : '#f8d7da'};
                                color: ${order.status === 'completed' ? '#155724' : 
                                       order.status === 'ready' ? '#004085' : 
                                       order.status === 'preparing' ? '#856404' : '#721c24'};
                            ">
                                ${order.status || 'Pending'}
                            </span>
                        </div>
                    </div>
                </div>
            `;
        });
        ordersHTML += '</div>';
        recentOrdersDiv.innerHTML = ordersHTML;
    }

    function showReports() {
        // Create and show the reports modal
        const modalHTML = `
            <div id="reportsModal" style="
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            ">
                <div style="
                    background: white;
                    padding: 30px;
                    border-radius: 8px;
                    width: 90%;
                    max-width: 1200px;
                    max-height: 90vh;
                    overflow-y: auto;
                    color: black;
                    position: relative;
                ">
                    <!-- Exit Button -->
                    <div style="position: absolute; top: 10px; right: 10px;">
                        <button onclick="closeReportsModal()" style="
                            background: #ff4444;
                            color: white;
                            border: none;
                            padding: 5px 10px;
                            border-radius: 4px;
                            cursor: pointer;
                        ">Exit</button>
                    </div>

                    <h2 style="text-align: center; margin-bottom: 20px;">Sales Reports & Analytics</h2>

                    <!-- Sales Overview Cards -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="stat-card" style="background: #e3f2fd; padding: 20px; border-radius: 8px;">
                            <h3>Today's Sales</h3>
                            <p id="reportTodaySales">$0.00</p>
                        </div>
                        <div class="stat-card" style="background: #e8f5e9; padding: 20px; border-radius: 8px;">
                            <h3>Weekly Sales</h3>
                            <p id="reportWeeklySales">$0.00</p>
                        </div>
                        <div class="stat-card" style="background: #fff3e0; padding: 20px; border-radius: 8px;">
                            <h3>Monthly Sales</h3>
                            <p id="reportMonthlySales">$0.00</p>
                        </div>
                        <div class="stat-card" style="background: #f3e5f5; padding: 20px; border-radius: 8px;">
                            <h3>Total Orders</h3>
                            <p id="reportTotalOrders">0</p>
                        </div>
                    </div>

                    <!-- Popular Items Section -->
                    <div style="margin-bottom: 30px;">
                        <h3>Top Selling Items</h3>
                        <div id="reportPopularItems" style="
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                            gap: 15px;
                            margin-top: 15px;
                        "></div>
                    </div>

                    <!-- Order Status Distribution -->
                    <div style="margin-bottom: 30px;">
                        <h3>Order Status Distribution</h3>
                        <div id="reportOrderStatus" style="
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                            gap: 15px;
                            margin-top: 15px;
                        "></div>
                    </div>

                    <!-- Sales by Category -->
                    <div style="margin-bottom: 30px;">
                        <h3>Sales by Category</h3>
                        <div id="reportCategories" style="margin-top: 15px;"></div>
                    </div>

                    <!-- Recent Orders Table -->
                    <div>
                        <h3>Recent Orders</h3>
                        <div id="reportRecentOrders" style="
                            margin-top: 15px;
                            max-height: 400px;
                            overflow-y: auto;
                        "></div>
                    </div>
                </div>
            </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHTML);
        generateReportsData();
    }

    function generateReportsData() {
        const allOrders = JSON.parse(localStorage.getItem('feedback')) || [];
        const today = new Date();
        const oneWeekAgo = new Date(today - 7 * 24 * 60 * 60 * 1000);
        const oneMonthAgo = new Date(today - 30 * 24 * 60 * 60 * 1000);

        // Calculate sales data
        const salesData = allOrders.reduce((acc, order) => {
            const orderDate = new Date(order.date);
            const orderTotal = order.order.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            // Track daily/weekly/monthly sales
            if (orderDate.toDateString() === today.toDateString()) {
                acc.todaySales += orderTotal;
            }
            if (orderDate >= oneWeekAgo) {
                acc.weeklySales += orderTotal;
            }
            if (orderDate >= oneMonthAgo) {
                acc.monthlySales += orderTotal;
            }

            // Track items and categories
            order.order.forEach(item => {
                // Track popular items
                if (!acc.items[item.name]) {
                    acc.items[item.name] = { quantity: 0, revenue: 0 };
                }
                acc.items[item.name].quantity += item.quantity;
                acc.items[item.name].revenue += item.price * item.quantity;

                // Track categories
                const category = item.category || 'Uncategorized';
                if (!acc.categories[category]) {
                    acc.categories[category] = 0;
                }
                acc.categories[category] += item.price * item.quantity;
            });

            // Track order status
            const status = order.status || 'pending';
            acc.statuses[status] = (acc.statuses[status] || 0) + 1;

            return acc;
        }, {
            todaySales: 0,
            weeklySales: 0,
            monthlySales: 0,
            items: {},
            categories: {},
            statuses: {}
        });

        // Update sales overview
        document.getElementById('reportTodaySales').textContent = `$${salesData.todaySales.toFixed(2)}`;
        document.getElementById('reportWeeklySales').textContent = `$${salesData.weeklySales.toFixed(2)}`;
        document.getElementById('reportMonthlySales').textContent = `$${salesData.monthlySales.toFixed(2)}`;
        document.getElementById('reportTotalOrders').textContent = allOrders.length;

        // Generate popular items
        const popularItemsHTML = Object.entries(salesData.items)
            .sort(([,a], [,b]) => b.quantity - a.quantity)
            .slice(0, 6)
            .map(([name, data]) => `
                <div style="background: #f5f5f5; padding: 15px; border-radius: 8px;">
                    <h4 style="margin: 0 0 10px 0;">${name}</h4>
                    <p style="margin: 5px 0;">Quantity: ${data.quantity}</p>
                    <p style="margin: 5px 0;">Revenue: $${data.revenue.toFixed(2)}</p>
                </div>
            `).join('');
        document.getElementById('reportPopularItems').innerHTML = popularItemsHTML;

        // Generate order status distribution
        const statusHTML = Object.entries(salesData.statuses)
            .map(([status, count]) => `
                <div style="background: #f5f5f5; padding: 15px; border-radius: 8px;">
                    <h4 style="margin: 0 0 10px 0;">${status.charAt(0).toUpperCase() + status.slice(1)}</h4>
                    <p style="margin: 0;">Orders: ${count}</p>
                </div>
            `).join('');
        document.getElementById('reportOrderStatus').innerHTML = statusHTML;

        // Generate category sales
        const categoryHTML = Object.entries(salesData.categories)
            .sort(([,a], [,b]) => b - a)
            .map(([category, total]) => `
                <div style="
                    display: flex;
                    justify-content: space-between;
                    padding: 10px;
                    background: ${category === 'Uncategorized' ? '#f5f5f5' : '#fff'};
                    margin: 5px 0;
                    border-radius: 4px;
                ">
                    <span>${category}</span>
                    <span>$${total.toFixed(2)}</span>
                </div>
            `).join('');
        document.getElementById('reportCategories').innerHTML = categoryHTML;

        // Generate recent orders table
        const recentOrdersHTML = `
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f5f5f5;">
                        <th style="padding: 10px; text-align: left;">Order Date</th>
                        <th style="padding: 10px; text-align: left;">Customer</th>
                        <th style="padding: 10px; text-align: left;">Items</th>
                        <th style="padding: 10px; text-align: right;">Total</th>
                        <th style="padding: 10px; text-align: center;">Status</th>
                    </tr>
                </thead>
                <tbody>
                    ${allOrders.slice(-10).reverse().map(order => {
                        const orderTotal = order.order.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                        return `
                            <tr style="border-bottom: 1px solid #eee;">
                                <td style="padding: 10px;">${new Date(order.date).toLocaleString()}</td>
                                <td style="padding: 10px;">${order.name}</td>
                                <td style="padding: 10px;">${order.order.map(item => `${item.name} (${item.quantity})`).join(', ')}</td>
                                <td style="padding: 10px; text-align: right;">$${orderTotal.toFixed(2)}</td>
                                <td style="padding: 10px; text-align: center;">
                                    <span style="
                                        padding: 4px 8px;
                                        border-radius: 12px;
                                        font-size: 12px;
                                        background: ${
                                            order.status === 'completed' ? '#c8e6c9' :
                                            order.status === 'ready' ? '#bbdefb' :
                                            order.status === 'preparing' ? '#fff9c4' :
                                            '#ffcdd2'
                                        };
                                    ">${order.status || 'pending'}</span>
                                </td>
                            </tr>
                        `;
                    }).join('')}
                </tbody>
            </table>
        `;
        document.getElementById('reportRecentOrders').innerHTML = recentOrdersHTML;
    }

    function closeReportsModal() {
        const modal = document.getElementById('reportsModal');
        if (modal) {
            modal.remove();
        }
    }

    function updateOrderStatus(index) {
        const allOrders = JSON.parse(localStorage.getItem('feedback')) || [];
        const order = allOrders[index];
        
        // Create and show the status update modal
        const modalHTML = `
            <div id="statusModal" style="
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            ">
                <div style="
                    background: white;
                    padding: 20px;
                    border-radius: 8px;
                    width: 300px;
                    color: black;
                ">
                    <h3 style="margin-top: 0;">Update Order Status</h3>
                    <div style="margin: 15px 0;">
                        <label>Current Status: ${order.status || 'pending'}</label>
                        <select id="newStatus" style="
                            width: 100%;
                            padding: 8px;
                            margin-top: 5px;
                            border: 1px solid #ddd;
                            border-radius: 4px;
                        ">
                            <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="preparing" ${order.status === 'preparing' ? 'selected' : ''}>Preparing</option>
                            <option value="ready" ${order.status === 'ready' ? 'selected' : ''}>Ready</option>
                            <option value="completed" ${order.status === 'completed' ? 'selected' : ''}>Completed</option>
                        </select>
                    </div>
                    <div style="display: flex; justify-content: flex-end; gap: 10px;">
                        <button onclick="closeStatusModal()" style="
                            padding: 8px 16px;
                            border: none;
                            border-radius: 4px;
                            cursor: pointer;
                            background: #ddd;
                        ">Cancel</button>
                        <button onclick="saveNewStatus(${index})" style="
                            padding: 8px 16px;
                            border: none;
                            border-radius: 4px;
                            cursor: pointer;
                            background: #2196F3;
                            color: white;
                        ">Save</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    }

    function closeStatusModal() {
        const modal = document.getElementById('statusModal');
        if (modal) {
            modal.remove();
        }
    }

    function saveNewStatus(index) {
        const newStatus = document.getElementById('newStatus').value;
        const allOrders = JSON.parse(localStorage.getItem('feedback')) || [];
        
        // Update the order status
        allOrders[index].status = newStatus;
        localStorage.setItem('feedback', JSON.stringify(allOrders));
        
        // Close the modal
        closeStatusModal();
        
        // Refresh the orders display
        displayActiveOrders();
        
        // Show success message
        alert(`Order status updated to ${newStatus}`);
    }

    function generateDailyReport() {
        const modalHTML = `
            <div id="reportModal" style="
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            ">
                <div class="restaurant-receipt" style="
                    background: white;
                    padding: 30px;
                    border-radius: 8px;
                    width: 380px;
                    max-height: 90vh;
                    overflow-y: auto;
                    color: black;
                    font-family: 'Courier New', monospace;
                    font-size: 14px;
                    position: relative;
                ">
                    <!-- Exit Button -->
                    <div style="position: absolute; top: 10px; right: 10px;">
                        <button onclick="closeReportModal()" style="
                            background: #ff4444;
                            color: white;
                            border: none;
                            padding: 5px 10px;
                            border-radius: 4px;
                            cursor: pointer;
                            font-family: Arial, sans-serif;
                            font-size: 12px;
                        ">Exit</button>
                    </div>

                    <div style="text-align: center; margin-bottom: 20px;">
                        <h2 style="margin: 0; font-size: 24px;">Hao's Signature</h2>
                        <p style="margin: 5px 0;">123 Restaurant Street</p>
                        <p style="margin: 5px 0;">City, State 12345</p>
                        <p style="margin: 5px 0;">Tel: (123) 456-7890</p>
                        <div style="border-bottom: 1px dashed black; margin: 15px 0;"></div>
                        <p style="margin: 5px 0;">Daily Sales Report</p>
                        <p style="margin: 5px 0;" id="receiptDate"></p>
                        <div style="border-bottom: 1px dashed black; margin: 15px 0;"></div>
                    </div>
                    <div id="reportContent">
                        <!-- Report content will be generated here -->
                    </div>
                    <div style="
                        text-align: center;
                        margin-top: 20px;
                        padding-top: 20px;
                    ">
                        <button onclick="printReport()" style="
                            background: #2196F3;
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 4px;
                            cursor: pointer;
                            font-family: Arial, sans-serif;
                        ">Print Receipt</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        generateReceiptContent();
    }

    function closeReportModal() {
        const modal = document.getElementById('reportModal');
        if (modal) {
            modal.remove();
        }
    }

    function printReport() {
        const printStyles = `
            @media print {
                @page {
                    size: A4;
                    margin: 0;
                }
                
                body * {
                    visibility: hidden;
                }
                
                #reportModal {
                    position: absolute;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    margin: 0;
                    padding: 0;
                }
                
                .restaurant-receipt {
                    visibility: visible;
                    position: fixed;
                    left: 50%;
                    top: 50%;
                    transform: translate(-50%, -50%);
                    width: 380px !important;
                    padding: 20px;
                    margin: 0 auto;
                    box-shadow: none;
                    background: white !important;
                    page-break-inside: avoid;
                }
                
                .restaurant-receipt * {
                    visibility: visible;
                    color: black !important;
                }
                
                button {
                    display: none !important;
                }
            }
        `;

        // Add print styles
        const styleSheet = document.createElement('style');
        styleSheet.innerText = printStyles;
        document.head.appendChild(styleSheet);

        // Trigger print
        window.print();

        // Remove print styles after printing
        setTimeout(() => {
            document.head.removeChild(styleSheet);
        }, 1000);
    }

    function generateReceiptContent() {
        const allOrders = JSON.parse(localStorage.getItem('feedback')) || [];
        const today = new Date();
        const reportContent = document.getElementById('reportContent');
        document.getElementById('receiptDate').textContent = today.toLocaleDateString();
        
        // Filter today's orders
        const todayOrders = allOrders.filter(order => 
            new Date(order.date).toDateString() === today.toDateString()
        );
        
        // Calculate daily totals and stats
        const dailyStats = todayOrders.reduce((acc, order) => {
            const orderTotal = order.order.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            acc.totalSales += orderTotal;
            
            // Track items
            order.order.forEach(item => {
                if (!acc.items[item.name]) {
                    acc.items[item.name] = {
                        quantity: 0,
                        revenue: 0
                    };
                }
                acc.items[item.name].quantity += item.quantity;
                acc.items[item.name].revenue += item.price * item.quantity;
            });

            // Track order statuses
            acc.statuses[order.status || 'pending'] = (acc.statuses[order.status || 'pending'] || 0) + 1;
            
            return acc;
        }, { 
            totalSales: 0, 
            items: {},
            statuses: {}
        });

        // Generate HTML content for the report
        let html = `
            <div style="margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                    <span>Total Orders:</span>
                    <span>${todayOrders.length}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                    <span>Total Sales:</span>
                    <span>$${dailyStats.totalSales.toFixed(2)}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                    <span>Avg Order Value:</span>
                    <span>$${(dailyStats.totalSales / (todayOrders.length || 1)).toFixed(2)}</span>
                </div>
            </div>

            <div style="border-bottom: 1px dashed black; margin: 15px 0;"></div>

            <div style="margin-bottom: 15px;">
                <p style="text-align: center; margin: 10px 0; font-weight: bold;">Order Status Summary</p>
                ${Object.entries(dailyStats.statuses)
                    .map(([status, count]) => `
                        <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                            <span>${status.charAt(0).toUpperCase() + status.slice(1)}:</span>
                            <span>${count}</span>
                        </div>
                    `).join('')}
            </div>

            <div style="border-bottom: 1px dashed black; margin: 15px 0;"></div>

            <div style="margin-bottom: 15px;">
                <p style="text-align: center; margin: 10px 0; font-weight: bold;">Items Sold</p>
                ${Object.entries(dailyStats.items)
                    .sort(([,a], [,b]) => b.quantity - a.quantity)
                    .map(([name, stats]) => `
                        <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                            <span>${name}</span>
                            <span>${stats.quantity}x $${stats.revenue.toFixed(2)}</span>
                        </div>
                    `).join('')}
            </div>

            <div style="text-align: center; font-size: 12px; margin-top: 20px;">
                <p>Generated: ${today.toLocaleString()}</p>
                <p>Thank you for your business!</p>
                <p>*** End of Report ***</p>
            </div>
        `;

        reportContent.innerHTML = html;
    }
</script>
</body>
</html> 